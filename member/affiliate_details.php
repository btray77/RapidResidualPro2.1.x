<?php// Include Files	include_once("include.php");	include_once("session.php");/**************************** Getting member info and setting menu things ***********************************/	$sql_men = "select * from ".$prefix."members where id='$_SESSION[memberid]'";	$row_mem = $db->get_a_line($sql_men);	@extract($row_mem);	$status	= $row_mem['status'];	$firstname 		= $row_mem['firstname'];	$username		= $row_mem['username'];	$status			= $row_mem['status'];	$smarty->assign('mid', $username);if($status == '1'){	$sql_page = "select affiliate_main as member_main, affiliate_menu_id from ".$prefix."misc_pages";	$row_page = $db->get_a_line($sql_page);	 // Getting menu alias 		$qry_menu_alias = "select * from ".$prefix."menus where id = '".$row_page['affiliate_menu_id']."'";		$row_menu_alias = $db->get_a_line($qry_menu_alias);		$menus = $objTpl->getPlaceHolders($row_menu_alias['menu_alias']);}elseif($status == '2'){	$sql_page = "select member_main as member_main, member_menu_id from ".$prefix."misc_pages"; 	$row_page = $db->get_a_line($sql_page);	 // Getting menu alias 		$qry_menu_alias = "select * from ".$prefix."menus where id = '".$row_page['member_menu_id']."'";		$row_menu_alias = $db->get_a_line($qry_menu_alias);	$menus = $objTpl->getPlaceHolders($row_menu_alias['menu_alias']);}elseif($status == '3'){	$sql_page = "select jv_main as member_main, jv_menu_id from ".$prefix."misc_pages";	$row_page = $db->get_a_line($sql_page);	// Getting menu alias 		$qry_menu_alias = "select * from ".$prefix."menus where id = '".$row_page['jv_menu_id']."'";		$row_menu_alias = $db->get_a_line($qry_menu_alias);	$menus = $objTpl->getPlaceHolders($row_menu_alias['menu_alias']);}/******************************************************************//********************************** Getting right panel content **************************************************/$mydownloads = $common->myDownloads($prefix,$db,$_SESSION[memberid]);$new_products = $common->newProducts($prefix,$db,$_SESSION[memberid]);/************************************************************************************/$smarty->assign('time_release_content',$time_release_content);$smarty->assign('my_downloads',$mydownloads);$smarty->assign('new_products',$new_products);$right_panel = $smarty->fetch('../html/member/right_panel.tpl');/***********************************************************************************/$ChangeColor = 1;$ToReplace = "";/********************************* Main Query **************************************************/	$sql = "	SELECT m.id, m.firstname, m.lastname, m.email, m.ref,m.randomstring,m.username, 	(SELECT COUNT(id) FROM ".$prefix."click_stats WHERE referrer = m.username  AND item_type <> '') AS click,	(SELECT COUNT(*) FROM ".$prefix."members WHERE ref = m.username) AS referer,	(SELECT count(p.id) FROM ".$prefix."orders o,".$prefix."products p  WHERE m.paypal_email = o.payee_email AND  o.item_number = p.id AND o.referrer = m.username AND o.payment_status='Completed') AS permotion,		(SELECT sum(o.payment_amount) FROM ".$prefix."orders o WHERE m.paypal_email = o.payee_email AND o.referrer = m.username AND o.payment_gateway ='') AS paypal,	(SELECT sum(o.payment_amount) FROM ".$prefix."orders o WHERE m.paypal_email = o.payee_email AND o.referrer = m.username AND o.payment_gateway ='') AS AlertPay		from ".$prefix."members m	WHERE m.id='".$_SESSION['memberid']."'	and (m.status=1	or m.status=2)";$reports = $db->get_rsltset($sql);$row_username = $db->get_a_line($sql);if(count($reports) > 0){	$i=0;	foreach($reports as $report){		/***********************************************************************/		$data[$i]['id'] = $report['id'];		$data[$i]['username'] = stripslashes($report['username']);		$data[$i]['firstname'] = $report['firstname'];		$data[$i]['lastname'] = $report['lastname'];		$data[$i]['email'] = $report['email'];		$data[$i]['referer'] = $report['ref'];		$data[$i]['permotion'] = $report['permotion'];		$data[$i]['click'] = $report['click'];		$data[$i]['paypal'] = number_format($report['paypal'],2);		$data[$i]['Alertpay'] = number_format($report['Alertpay'],2);		$i++; 	}}function days_in_month($month, $year){	return $month == 2 ? ($year % 4 ? 28 : ($year % 100 ? 29 : ($year % 400 ? 28 : 29))) : (($month - 1) % 7 % 2 ? 30 : 31);}if(empty($month))$month=date('m');if(empty($year))$year=date('Y');// Years loopfor($i =2011;$i<2021;$i++){	$yyear[] = $i;}$smarty->assign('yyear', $yyear);$datei = 0;// Daywise statsfor($day=1;$day <= days_in_month($month,$year);$day++){	$days[$datei]['day'] = $day;	$days[$datei]['date'] = $day.'-'. $month .'-'. $year;	$days[$datei]['start_date'] =  $year.'-'. $month .'-'. $day;		$sql_sales = "select count(payment_amount) as sales from ".$prefix."orders o, ".$prefix."members m				where m.paypal_email = o.payee_email				AND referrer = '$username'				AND o.date ='".$days[$datei]['start_date']."'				AND o.payment_status='Completed';";		$row_sales= $db->get_a_line($sql_sales);	if($row_sales['sales']> 0)		$days[$datei]['sales'] = $row_sales['sales'];	else		$days[$datei]['sales'] = '--';	$sql_earned = "select SUM(payment_amount) as earning from ".$prefix."orders o, ".$prefix."members m				where m.paypal_email = o.payee_email				AND referrer = '$username' 				AND o.date ='".$days[$datei]['start_date']."' 				AND o.payment_status='Completed';";	$row_earned = $db->get_a_line($sql_earned);	if($row_earned['earning']> 0)		$days[$datei]['earned'] = '$ '.number_format($row_earned['earning'],2);	else		$days[$datei]['earned'] = '--';                $sql_views = "select count(id) as views from ".$prefix."click_stats where referrer = '$username' and visited_date = '".$days[$datei]['start_date']."'  AND item_type <> ''";	$row_views = $db->get_a_line($sql_views);                if($row_views['views']> 0)		$days[$datei]['views'] = $row_views['views'] ;	else		$days[$datei]['views'] = '--';        					$sql_impression = "select count(id) as impression from ".$prefix."click_stats where referrer = '$username' and visited_date = '".$days[$datei]['start_date']."'";	$row_impression = $db->get_a_line($sql_impression);		if($row_impression['impression']> 0)	$days[$datei]['impression'] = $row_impression['impression'] ;	else	$days[$datei]['impression'] = '--';								        if($row_views['views']> 0){                $conversion = (($row_sales['sales'] * 100) / $row_views['views']);		$days[$datei]['conversion'] = number_format($conversion,2) .' %';                }	else		$days[$datei]['conversion'] = '--';        if($row_views['views'] > 0)        {                $epc = ($row_earned['earning'] / $row_views['views']);		$days[$datei]['epc'] = number_format($row_earned['epc'],2);        }	else		$days[$datei]['epc'] = '--';	$datei++;}$smarty->assign('dayy', $days);$days=days_in_month($month,$year);	$start_date=$year.'-'.$month . '-01';	$end_date=$year.'-'.$month . '-' .$days;		// Total Affiliates this month	$sql_aff_mon = "SELECT count(id) as total FROM ".$prefix."members WHERE ref = '".$row_username['username']."' and date_joined between '$start_date' and '$end_date'";	$row_total= $db->get_a_line($sql_aff_mon);	$smarty->assign('totalAffiliatemon', $row_total['total']);		// All Affilaites	$sql_aff_all = "select count(id) as total from ".$prefix."members where ref = '".$row_username['username']."'";	$row_total_aff_all = $db->get_a_line($sql_aff_all);	$smarty->assign('allAffiliate', $row_total_aff_all['total']);		// ALL CLICKS	$row_total_clicks_today = $db->get_a_line("SELECT count(id) as total from rrp_click_stats where `referrer` ='$row_username[username]' AND visited_date between '$start_date' and '$end_date'  AND item_type <> ''");	$row_total_clicks_today = $row_total_clicks_today['total'];	$smarty->assign('row_total_clicks_today', $row_total_clicks_today);		$row_total_clicks_all = $db->get_a_line("SELECT count(id) as total from rrp_click_stats where `referrer` ='$row_username[username]' AND item_type <> ''");	 $row_total_clicks_all = $row_total_clicks_all['total'];	 $smarty->assign('row_total_clicks_all', $row_total_clicks_all);	// ALL VIEWS		$row_total_views_today = $db->get_a_line("SELECT count(id) as total from rrp_click_stats where `referrer` ='$row_username[username]' AND visited_date between '$start_date' and '$end_date'");	 $row_total_views_today = $row_total_views_today['total'];	 $smarty->assign('row_total_views_today', $row_total_views_today);	 	$row_total_views_all = $db->get_a_line("SELECT count(id) as total from rrp_click_stats where `referrer` ='$row_username[username]'");	 $row_total_views_all = $row_total_views_all['total'];	 $smarty->assign('row_total_views_all', $row_total_views_all);	// This month product	$sql_thismonthprod = "select count(payment_amount) as total from ".$prefix."orders o, ".$prefix."members m							where m.paypal_email = o.payee_email							AND referrer = '".$row_username['username']."'							AND o.date between '$start_date' and '$end_date'							AND o.payment_status='Completed';";	$row_thismonth = $db->get_a_line($sql_thismonthprod);	if($row_thismonth['total']){		$thismonthprod = $row_thismonth['total'];	}else{		$thismonthprod = '0';	}	$smarty->assign('thismonthprod', $thismonthprod);		// Accumulated Product	$sql_accumulatedprod = "select count(payment_amount) as total from ".$prefix."orders o, ".$prefix."members m							where m.paypal_email = o.payee_email							AND referrer = '".$row_username['username']."'							AND o.payment_status='Completed';";	$row_accumulated = $db->get_a_line($sql_accumulatedprod);	if($row_accumulated['total']){		$thismonthaccprod = $row_accumulated['total'];	}else{		$thismonthaccprod = '0';	}	$smarty->assign('thismonthaccprod', $thismonthaccprod);			// Commission this month	$sql_com_mon = "select SUM(payment_amount) as total from ".$prefix."orders o, ".$prefix."members m 			where m.paypal_email = o.payee_email			AND referrer = '$username' 			AND o.date between '$start_date' and '$end_date'			AND o.payment_status='Completed';";	$row_com_mon = $db->get_a_line($sql_com_mon);	$com_mon = '$ '.number_format($row_com_mon['total'],2);	$smarty->assign('com_mon', $com_mon);			// All Commission	$sql_com_all = "select SUM(payment_amount) as total from ".$prefix."orders o, ".$prefix."members m 					where m.paypal_email = o.payee_email					AND referrer = '$username' 					AND o.payment_status='Completed';";	$row_com_all = $db->get_a_line($sql_com_all);	$com_all = '$ '.number_format($row_com_all['total'],2);	$smarty->assign('com_all', $com_all);	/************************************ Assigning inner content to template file ***********************************************/$smarty->assign('month', $month);$smarty->assign('year', $year);$smarty->assign('data',$data);$smarty->assign('i', '0');$smarty->assign('targetpage', $targetpage);$output_market = $smarty->fetch('../html/affiliate_details.tpl');$smarty->assign('pagename','Detail Report');$smarty->assign('main_content',$output_market);$output = $smarty->fetch('../html/member/content.tpl');/***********************************************************************************//************************************** Template code here *********************************************/$objTpl = new TPLManager($FILEPATH.'/index.html');$hotspots = $objTpl->getHotspotList();$placeHolders = $objTpl->getPlaceHolders($hotspots);$i=0;foreach($placeHolders as  $items){	$smarty->assign("$hotspots[$i]","$items");	$i++;}/***********************************************************************************//************************************** Assigning everything to main template *********************************************/$smarty->assign("menus",$menus);$smarty->assign('current_date',$today);$smarty->assign('right_panel',$right_panel);$smarty->assign('sidebar',$right_panel);$smarty->assign('error',$Message);$smarty->assign('content',$output);$smarty->display($FILEPATH.'/index.html');/***********************************************************************************/?>